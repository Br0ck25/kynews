import{d as M,r,w as V,_ as A,e as R,f as K,g as D,h as F,R as t,i as H,I as T,j as U,u as Y,k as G,s as q,l as P,m as J,T as x,K as Q,L as X,B as Z,C as ee,n as te,S as ne,o as re}from"./index-68c678c9.js";import{S as ae}from"./skeletons-component-f6be9953.js";import{F as oe}from"./featured-post-component-420d7fa0.js";import{P as ce}from"./posts-component-7b32dd69.js";import{F as se,I as le,S as ie}from"./Select-c60b24bd.js";import{M as ue}from"./MenuItem-a33ebd46.js";import{S as de}from"./SwitchBase-b519d224.js";const me=M(r.createElement("path",{d:"M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"})),fe=M(r.createElement("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"})),pe=M(r.createElement("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10H7v-2h10v2z"}));var he=function(n){return{root:{color:n.palette.text.secondary},checked:{},disabled:{},indeterminate:{},colorPrimary:{"&$checked":{color:n.palette.primary.main,"&:hover":{backgroundColor:F(n.palette.primary.main,n.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},"&$disabled":{color:n.palette.action.disabled}},colorSecondary:{"&$checked":{color:n.palette.secondary.main,"&:hover":{backgroundColor:F(n.palette.secondary.main,n.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},"&$disabled":{color:n.palette.action.disabled}}}},ve=r.createElement(fe,null),Ee=r.createElement(me,null),ge=r.createElement(pe,null),be=r.forwardRef(function(n,_){var I=n.checkedIcon,h=I===void 0?ve:I,c=n.classes,d=n.color,l=d===void 0?"secondary":d,v=n.icon,E=v===void 0?Ee:v,g=n.indeterminate,s=g===void 0?!1:g,b=n.indeterminateIcon,m=b===void 0?ge:b,C=n.inputProps,w=n.size,i=w===void 0?"medium":w,z=A(n,["checkedIcon","classes","color","icon","indeterminate","indeterminateIcon","inputProps","size"]),f=s?m:E,p=s?m:h;return r.createElement(de,R({type:"checkbox",classes:{root:K(c.root,c["color".concat(D(l))],s&&c.indeterminate),checked:c.checked,disabled:c.disabled},color:l,inputProps:R({"data-indeterminate":s},C),icon:r.cloneElement(f,{fontSize:f.props.fontSize===void 0&&i==="small"?i:f.props.fontSize}),checkedIcon:r.cloneElement(p,{fontSize:p.props.fontSize===void 0&&i==="small"?i:p.props.fontSize}),ref:_},z))});const ke=V(he,{name:"MuiCheckbox"})(be);function Se(){const[a,n]=r.useState(!navigator.onLine);return setTimeout(()=>{n(!1)},10*1e3),t.createElement(H,{anchorOrigin:{vertical:"top",horizontal:"center"},open:a,message:"You're offline right now. Recently viewed articles will be shown when available.",action:t.createElement(T,{"aria-label":"close",color:"inherit",onClick:()=>n(!a)},t.createElement(U,null))})}const Ie=te(a=>({root:{},countyFilterWrap:{marginBottom:a.spacing(2)},close:{padding:a.spacing(.5)},loaderWrap:{display:"flex",justifyContent:"center",padding:a.spacing(3)}})),N=new ne,Ce=20;function O(a){return Ce}function Le({category:a,title:n,countyFilterEnabled:_=!1,filterPosts:I}){const h=Ie(),c=Y(e=>e.selectedCounties),d=G(),[l,v]=r.useState([]),[E,g]=r.useState(null),[s,b]=r.useState(!0),[m,C]=r.useState(!0),[w,i]=r.useState(!1),[z,f]=r.useState(""),p=r.useRef(null),k=r.useRef(!1),S=r.useRef(!0),L=(c||[]).join("|"),$=a==="national"?[]:c||[],W=(c||[]).length>0;r.useEffect(()=>{d(q(n))},[n,d]),r.useEffect(()=>()=>{S.current=!1},[]),r.useEffect(()=>{S.current=!0,v([]),g(null),b(!0),C(!0),f(""),k.current=!1;let e=!0;return N.fetchPage({category:a,counties:$,cursor:null,limit:O()}).then(({posts:o,nextCursor:u})=>{!e||!S.current||P.unstable_batchedUpdates(()=>{v(o),g(u),b(u!==null),d(J(o)),C(!1)})}).catch(o=>{!e||!S.current||P.unstable_batchedUpdates(()=>{f(o.errorMessage||"Failed to load posts."),C(!1)})}),()=>{e=!1}},[a,L]);const y=r.useCallback(()=>{k.current||!s||!E||(k.current=!0,i(!0),N.fetchPage({category:a,counties:$,cursor:E,limit:O()}).then(({posts:e,nextCursor:o})=>{S.current&&P.unstable_batchedUpdates(()=>{v(u=>[...u,...e]),g(o),b(o!==null),k.current=!1,i(!1)})}).catch(()=>{S.current&&P.unstable_batchedUpdates(()=>{k.current=!1,i(!1)})}))},[a,L,E,s]);r.useEffect(()=>{const e=p.current;if(!e)return;let o;typeof IntersectionObserver<"u"&&(o=new IntersectionObserver(B=>{B[0].isIntersecting&&y()},{rootMargin:"400px"}),o.observe(e));const u=()=>{if(!e)return;e.getBoundingClientRect().top<=window.innerHeight+400&&y()};return window.addEventListener("scroll",u,{passive:!0}),u(),()=>{o&&o.disconnect(),window.removeEventListener("scroll",u)}},[y,m]),r.useEffect(()=>{if(m||k.current||!s||!E)return;const e=p.current;if(!e)return;e.getBoundingClientRect().top<=window.innerHeight+400&&y()},[l.length,s,m,y]);const j=e=>{d(re(e.target.value))};return t.createElement("div",{className:h.root},t.createElement(Se,null),t.createElement(x,{variant:"h5",component:"h1",gutterBottom:!0},n),_&&a!=="national"&&t.createElement("div",{className:h.countyFilterWrap},t.createElement(se,{fullWidth:!0,variant:"outlined",size:"small"},t.createElement(le,{id:`${a}-counties-label`},"Counties"),t.createElement(ie,{labelId:`${a}-counties-label`,multiple:!0,value:c,onChange:j,label:"Counties",renderValue:e=>e.length>0?e.join(", "):"All counties"},Q.map(e=>t.createElement(ue,{key:e,value:e},t.createElement(ke,{checked:c.indexOf(e)>-1}),t.createElement(X,{primary:e})))))),m?t.createElement(ae,{showFeaturedSkeleton:!0}):l.length===0?t.createElement(x,{variant:"body1"},a==="national"?"No articles found for this section.":W?"No articles found for the selected counties.":"No articles found for this section yet."):t.createElement(t.Fragment,null,(()=>{const e=I?l.filter(I):l;return e.length===0?t.createElement(x,{variant:"body1"},"No articles found for this section yet."):t.createElement(t.Fragment,null,t.createElement(oe,{post:e[0]}),t.createElement(ce,{posts:e.slice(1)}))})(),t.createElement("div",{ref:p,style:{height:1}}),w&&t.createElement(Z,{className:h.loaderWrap},t.createElement(ee,{size:32})),!s&&l.length>0&&t.createElement(x,{variant:"body2",color:"textSecondary",align:"center",style:{padding:16}},"All articles loaded.")),t.createElement(H,{anchorOrigin:{vertical:"top",horizontal:"center"},open:!!z,message:z,key:`${a}-error`,action:t.createElement(T,{"aria-label":"close",color:"inherit",className:h.close,onClick:()=>f("")},t.createElement(U,null))}))}export{Le as C};
