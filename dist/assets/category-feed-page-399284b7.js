import{d as L,r,w as j,_ as V,e as B,f as K,g as D,h as F,R as t,i as T,I as A,j as H,u as Y,k as G,s as q,l as w,m as J,T as z,K as Q,L as X,B as Z,C as ee,n as te,S as ne,o as re}from"./index-0bafab06.js";import{S as ae}from"./skeletons-component-d1d86919.js";import{F as oe}from"./featured-post-component-65e7e2b0.js";import{P as ce}from"./posts-component-88a8037a.js";import{F as se,I as le,S as ie}from"./Select-5d32744b.js";import{M as ue}from"./MenuItem-60b7dbd8.js";import{S as de}from"./SwitchBase-5a35bd19.js";const me=L(r.createElement("path",{d:"M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"})),fe=L(r.createElement("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"})),pe=L(r.createElement("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10H7v-2h10v2z"}));var he=function(n){return{root:{color:n.palette.text.secondary},checked:{},disabled:{},indeterminate:{},colorPrimary:{"&$checked":{color:n.palette.primary.main,"&:hover":{backgroundColor:F(n.palette.primary.main,n.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},"&$disabled":{color:n.palette.action.disabled}},colorSecondary:{"&$checked":{color:n.palette.secondary.main,"&:hover":{backgroundColor:F(n.palette.secondary.main,n.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},"&$disabled":{color:n.palette.action.disabled}}}},ve=r.createElement(fe,null),Ee=r.createElement(me,null),ge=r.createElement(pe,null),be=r.forwardRef(function(n,x){var I=n.checkedIcon,h=I===void 0?ve:I,c=n.classes,d=n.color,l=d===void 0?"secondary":d,v=n.icon,E=v===void 0?Ee:v,g=n.indeterminate,s=g===void 0?!1:g,b=n.indeterminateIcon,m=b===void 0?ge:b,C=n.inputProps,P=n.size,i=P===void 0?"medium":P,_=V(n,["checkedIcon","classes","color","icon","indeterminate","indeterminateIcon","inputProps","size"]),f=s?m:E,p=s?m:h;return r.createElement(de,B({type:"checkbox",classes:{root:K(c.root,c["color".concat(D(l))],s&&c.indeterminate),checked:c.checked,disabled:c.disabled},color:l,inputProps:B({"data-indeterminate":s},C),icon:r.cloneElement(f,{fontSize:f.props.fontSize===void 0&&i==="small"?i:f.props.fontSize}),checkedIcon:r.cloneElement(p,{fontSize:p.props.fontSize===void 0&&i==="small"?i:p.props.fontSize}),ref:x},_))});const Se=j(he,{name:"MuiCheckbox"})(be);function ke(){const[a,n]=r.useState(!navigator.onLine);return setTimeout(()=>{n(!1)},10*1e3),t.createElement(T,{anchorOrigin:{vertical:"top",horizontal:"center"},open:a,message:"You're offline right now. Recently viewed articles will be shown when available.",action:t.createElement(A,{"aria-label":"close",color:"inherit",onClick:()=>n(!a)},t.createElement(H,null))})}const Ie=te(a=>({root:{},countyFilterWrap:{marginBottom:a.spacing(2)},close:{padding:a.spacing(.5)},loaderWrap:{display:"flex",justifyContent:"center",padding:a.spacing(3)}})),N=new ne({}.REACT_APP_API_BASE_URL),Ce=20;function O(a){return Ce}function Me({category:a,title:n,countyFilterEnabled:x=!1,filterPosts:I}){const h=Ie(),c=Y(e=>e.selectedCounties),d=G(),[l,v]=r.useState([]),[E,g]=r.useState(null),[s,b]=r.useState(!0),[m,C]=r.useState(!0),[P,i]=r.useState(!1),[_,f]=r.useState(""),p=r.useRef(null),S=r.useRef(!1),k=r.useRef(!0),M=(c||[]).join("|"),R=a==="national"?[]:c||[],U=(c||[]).length>0;r.useEffect(()=>{d(q(n))},[n,d]),r.useEffect(()=>()=>{k.current=!1},[]),r.useEffect(()=>{k.current=!0,v([]),g(null),b(!0),C(!0),f(""),S.current=!1;let e=!0;return N.fetchPage({category:a,counties:R,cursor:null,limit:O()}).then(({posts:o,nextCursor:u})=>{!e||!k.current||w.unstable_batchedUpdates(()=>{v(o),g(u),b(u!==null),d(J(o)),C(!1)})}).catch(o=>{!e||!k.current||w.unstable_batchedUpdates(()=>{f(o.errorMessage||"Failed to load posts."),C(!1)})}),()=>{e=!1}},[a,M]);const y=r.useCallback(()=>{S.current||!s||!E||(S.current=!0,i(!0),N.fetchPage({category:a,counties:R,cursor:E,limit:O()}).then(({posts:e,nextCursor:o})=>{k.current&&w.unstable_batchedUpdates(()=>{v(u=>[...u,...e]),g(o),b(o!==null),S.current=!1,i(!1)})}).catch(()=>{k.current&&w.unstable_batchedUpdates(()=>{S.current=!1,i(!1)})}))},[a,M,E,s]);r.useEffect(()=>{const e=p.current;if(!e)return;let o;typeof IntersectionObserver<"u"&&(o=new IntersectionObserver($=>{$[0].isIntersecting&&y()},{rootMargin:"400px"}),o.observe(e));const u=()=>{if(!e)return;e.getBoundingClientRect().top<=window.innerHeight+400&&y()};return window.addEventListener("scroll",u,{passive:!0}),u(),()=>{o&&o.disconnect(),window.removeEventListener("scroll",u)}},[y,m]),r.useEffect(()=>{if(m||S.current||!s||!E)return;const e=p.current;if(!e)return;e.getBoundingClientRect().top<=window.innerHeight+400&&y()},[l.length,s,m,y]);const W=e=>{d(re(e.target.value))};return t.createElement("div",{className:h.root},t.createElement(ke,null),t.createElement(z,{variant:"h5",component:"h1",gutterBottom:!0},n),x&&a!=="national"&&t.createElement("div",{className:h.countyFilterWrap},t.createElement(se,{fullWidth:!0,variant:"outlined",size:"small"},t.createElement(le,{id:`${a}-counties-label`},"Counties"),t.createElement(ie,{labelId:`${a}-counties-label`,multiple:!0,value:c,onChange:W,label:"Counties",renderValue:e=>e.length>0?e.join(", "):"All counties"},Q.map(e=>t.createElement(ue,{key:e,value:e},t.createElement(Se,{checked:c.indexOf(e)>-1}),t.createElement(X,{primary:e})))))),m?t.createElement(ae,{showFeaturedSkeleton:!0}):l.length===0?t.createElement(z,{variant:"body1"},a==="national"?"No articles found for this section.":U?"No articles found for the selected counties.":"No articles found for this section yet."):t.createElement(t.Fragment,null,(()=>{const e=I?l.filter(I):l;return e.length===0?t.createElement(z,{variant:"body1"},"No articles found for this section yet."):t.createElement(t.Fragment,null,t.createElement(oe,{post:e[0]}),t.createElement(ce,{posts:e.slice(1)}))})(),t.createElement("div",{ref:p,style:{height:1}}),P&&t.createElement(Z,{className:h.loaderWrap},t.createElement(ee,{size:32})),!s&&l.length>0&&t.createElement(z,{variant:"body2",color:"textSecondary",align:"center",style:{padding:16}},"All articles loaded.")),t.createElement(T,{anchorOrigin:{vertical:"top",horizontal:"center"},open:!!_,message:_,key:`${a}-error`,action:t.createElement(A,{"aria-label":"close",color:"inherit",className:h.close,onClick:()=>f("")},t.createElement(H,null))}))}export{Me as C};
