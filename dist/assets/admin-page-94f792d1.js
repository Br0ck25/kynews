import{a3 as Wt,a4 as Ht,a5 as Ft,a6 as Kt,w as te,r as n,a7 as jt,_ as ae,a8 as Ot,a9 as qt,e as D,f as Y,aa as Vt,ab as At,ac as ut,ad as Jt,P as me,U as Yt,I as Gt,g as Oe,ae as Qt,h as Qe,af as Xt,a0 as Zt,a1 as ea,a2 as ta,R as e,B as $,T as v,a as C,ag as aa,ah as xe,J as U,K as na,C as mt,S as la}from"./index-4c6cfbd6.js";import{T as ee}from"./TextField-a4f4e008.js";import{F as qe,I as pt,S as _e}from"./Select-25888060.js";import{M as ie}from"./MenuItem-d854b7fe.js";import{F as gt,S as yt}from"./Switch-d1a697ff.js";import"./useFormControl-995efb29.js";import"./SwitchBase-a6a24965.js";function ra(u){return Wt(u)||Ht(u)||Ft(u)||Kt()}var ia=function(a){return{container:{height:0,overflow:"hidden",transition:a.transitions.create("height")},entered:{height:"auto",overflow:"visible"},hidden:{visibility:"hidden"},wrapper:{display:"flex"},wrapperInner:{width:"100%"}}},St=n.forwardRef(function(a,d){var p=a.children,s=a.classes,i=a.className,m=a.collapsedHeight,y=m===void 0?"0px":m,b=a.component,R=b===void 0?"div":b,B=a.disableStrictModeCompat,T=B===void 0?!1:B,x=a.in,N=a.onEnter,g=a.onEntered,_=a.onEntering,L=a.onExit,W=a.onExited,I=a.onExiting,w=a.style,A=a.timeout,k=A===void 0?jt.standard:A,f=a.TransitionComponent,z=f===void 0?Vt:f,P=ae(a,["children","classes","className","collapsedHeight","component","disableStrictModeCompat","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","style","timeout","TransitionComponent"]),G=Ot(),Q=n.useRef(),O=n.useRef(null),ne=n.useRef(),oe=typeof y=="number"?"".concat(y,"px"):y;n.useEffect(function(){return function(){clearTimeout(Q.current)}},[]);var X=G.unstable_strictMode&&!T,H=n.useRef(null),$e=qt(d,X?H:void 0),q=function(S){return function(F,K){if(S){var j=X?[H.current,F]:[F,K],le=At(j,2),he=le[0],de=le[1];de===void 0?S(he):S(he,de)}}},pe=q(function(h,S){h.style.height=oe,N&&N(h,S)}),se=q(function(h,S){var F=O.current?O.current.clientHeight:0,K=ut({style:w,timeout:k},{mode:"enter"}),j=K.duration;if(k==="auto"){var le=G.transitions.getAutoHeightDuration(F);h.style.transitionDuration="".concat(le,"ms"),ne.current=le}else h.style.transitionDuration=typeof j=="string"?j:"".concat(j,"ms");h.style.height="".concat(F,"px"),_&&_(h,S)}),ge=q(function(h,S){h.style.height="auto",g&&g(h,S)}),Re=q(function(h){var S=O.current?O.current.clientHeight:0;h.style.height="".concat(S,"px"),L&&L(h)}),ye=q(W),ce=q(function(h){var S=O.current?O.current.clientHeight:0,F=ut({style:w,timeout:k},{mode:"exit"}),K=F.duration;if(k==="auto"){var j=G.transitions.getAutoHeightDuration(S);h.style.transitionDuration="".concat(j,"ms"),ne.current=j}else h.style.transitionDuration=typeof K=="string"?K:"".concat(K,"ms");h.style.height=oe,I&&I(h)}),fe=function(S,F){var K=X?S:F;k==="auto"&&(Q.current=setTimeout(K,ne.current||0))};return n.createElement(z,D({in:x,onEnter:pe,onEntered:ge,onEntering:se,onExit:Re,onExited:ye,onExiting:ce,addEndListener:fe,nodeRef:X?H:void 0,timeout:k==="auto"?null:k},P),function(h,S){return n.createElement(R,D({className:Y(s.container,i,{entered:s.entered,exited:!x&&oe==="0px"&&s.hidden}[h]),style:D({minHeight:oe},w),ref:$e},S),n.createElement("div",{className:s.wrapper,ref:O},n.createElement("div",{className:s.wrapperInner},p)))})});St.muiSupportAuto=!0;const oa=te(ia,{name:"MuiCollapse"})(St);var sa=n.createContext({});const kt=sa;var ca=function(a){var d={duration:a.transitions.duration.shortest};return{root:{position:"relative",transition:a.transitions.create(["margin"],d),"&:before":{position:"absolute",left:0,top:-1,right:0,height:1,content:'""',opacity:1,backgroundColor:a.palette.divider,transition:a.transitions.create(["opacity","background-color"],d)},"&:first-child":{"&:before":{display:"none"}},"&$expanded":{margin:"16px 0","&:first-child":{marginTop:0},"&:last-child":{marginBottom:0},"&:before":{opacity:0}},"&$expanded + &":{"&:before":{display:"none"}},"&$disabled":{backgroundColor:a.palette.action.disabledBackground}},rounded:{borderRadius:0,"&:first-child":{borderTopLeftRadius:a.shape.borderRadius,borderTopRightRadius:a.shape.borderRadius},"&:last-child":{borderBottomLeftRadius:a.shape.borderRadius,borderBottomRightRadius:a.shape.borderRadius,"@supports (-ms-ime-align: auto)":{borderBottomLeftRadius:0,borderBottomRightRadius:0}}},expanded:{},disabled:{}}},da=n.forwardRef(function(a,d){var p=a.children,s=a.classes,i=a.className,m=a.defaultExpanded,y=m===void 0?!1:m,b=a.disabled,R=b===void 0?!1:b,B=a.expanded,T=a.onChange,x=a.square,N=x===void 0?!1:x,g=a.TransitionComponent,_=g===void 0?oa:g,L=a.TransitionProps,W=ae(a,["children","classes","className","defaultExpanded","disabled","expanded","onChange","square","TransitionComponent","TransitionProps"]),I=Jt({controlled:B,default:y,name:"Accordion",state:"expanded"}),w=At(I,2),A=w[0],k=w[1],f=n.useCallback(function(ne){k(!A),T&&T(ne,!A)},[A,T,k]),z=n.Children.toArray(p),P=ra(z),G=P[0],Q=P.slice(1),O=n.useMemo(function(){return{expanded:A,disabled:R,toggle:f}},[A,R,f]);return n.createElement(me,D({className:Y(s.root,i,A&&s.expanded,R&&s.disabled,!N&&s.rounded),ref:d,square:N},W),n.createElement(kt.Provider,{value:O},G),n.createElement(_,D({in:A,timeout:"auto"},L),n.createElement("div",{"aria-labelledby":G.props.id,id:G.props["aria-controls"],role:"region"},Q)))});const Ve=te(ca,{name:"MuiAccordion"})(da);var ua=function(a){return{root:{display:"flex",padding:a.spacing(1,2,2)}}},ma=n.forwardRef(function(a,d){var p=a.classes,s=a.className,i=ae(a,["classes","className"]);return n.createElement("div",D({className:Y(p.root,s),ref:d},i))});const Je=te(ua,{name:"MuiAccordionDetails"})(ma);var pa=function(a){var d={duration:a.transitions.duration.shortest};return{root:{display:"flex",minHeight:8*6,transition:a.transitions.create(["min-height","background-color"],d),padding:a.spacing(0,2),"&:hover:not($disabled)":{cursor:"pointer"},"&$expanded":{minHeight:64},"&$focused":{backgroundColor:a.palette.action.focus},"&$disabled":{opacity:a.palette.action.disabledOpacity}},expanded:{},focused:{},disabled:{},content:{display:"flex",flexGrow:1,transition:a.transitions.create(["margin"],d),margin:"12px 0","&$expanded":{margin:"20px 0"}},expandIcon:{transform:"rotate(0deg)",transition:a.transitions.create("transform",d),"&:hover":{backgroundColor:"transparent"},"&$expanded":{transform:"rotate(180deg)"}}}},ga=n.forwardRef(function(a,d){var p=a.children,s=a.classes,i=a.className,m=a.expandIcon,y=a.IconButtonProps,b=a.onBlur,R=a.onClick,B=a.onFocusVisible,T=ae(a,["children","classes","className","expandIcon","IconButtonProps","onBlur","onClick","onFocusVisible"]),x=n.useState(!1),N=x[0],g=x[1],_=function(P){g(!0),B&&B(P)},L=function(P){g(!1),b&&b(P)},W=n.useContext(kt),I=W.disabled,w=I===void 0?!1:I,A=W.expanded,k=W.toggle,f=function(P){k&&k(P),R&&R(P)};return n.createElement(Yt,D({focusRipple:!1,disableRipple:!0,disabled:w,component:"div","aria-expanded":A,className:Y(s.root,i,w&&s.disabled,A&&s.expanded,N&&s.focused),onFocusVisible:_,onBlur:L,onClick:f,ref:d},T),n.createElement("div",{className:Y(s.content,A&&s.expanded)},p),m&&n.createElement(Gt,D({className:Y(s.expandIcon,A&&s.expanded),edge:"end",component:"div",tabIndex:null,role:null,"aria-hidden":!0},y),m))});const Ye=te(pa,{name:"MuiAccordionSummary"})(ga);var ya=n.createContext();const $t=ya;var fa=function(a){return{root:{display:"table",width:"100%",borderCollapse:"collapse",borderSpacing:0,"& caption":D({},a.typography.body2,{padding:a.spacing(2),color:a.palette.text.secondary,textAlign:"left",captionSide:"bottom"})},stickyHeader:{borderCollapse:"separate"}}},ft="table",ha=n.forwardRef(function(a,d){var p=a.classes,s=a.className,i=a.component,m=i===void 0?ft:i,y=a.padding,b=y===void 0?"default":y,R=a.size,B=R===void 0?"medium":R,T=a.stickyHeader,x=T===void 0?!1:T,N=ae(a,["classes","className","component","padding","size","stickyHeader"]),g=n.useMemo(function(){return{padding:b,size:B,stickyHeader:x}},[b,B,x]);return n.createElement($t.Provider,{value:g},n.createElement(m,D({role:m===ft?null:"table",ref:d,className:Y(p.root,s,x&&p.stickyHeader)},N)))});const Ae=te(fa,{name:"MuiTable"})(ha);var va=n.createContext();const Ue=va;var Ea={root:{display:"table-row-group"}},ba={variant:"body"},ht="tbody",Ca=n.forwardRef(function(a,d){var p=a.classes,s=a.className,i=a.component,m=i===void 0?ht:i,y=ae(a,["classes","className","component"]);return n.createElement(Ue.Provider,{value:ba},n.createElement(m,D({className:Y(p.root,s),ref:d,role:m===ht?null:"rowgroup"},y)))});const Se=te(Ea,{name:"MuiTableBody"})(Ca);var xa=function(a){return{root:D({},a.typography.body2,{display:"table-cell",verticalAlign:"inherit",borderBottom:`1px solid
    `.concat(a.palette.type==="light"?Qt(Qe(a.palette.divider,1),.88):Xt(Qe(a.palette.divider,1),.68)),textAlign:"left",padding:16}),head:{color:a.palette.text.primary,lineHeight:a.typography.pxToRem(24),fontWeight:a.typography.fontWeightMedium},body:{color:a.palette.text.primary},footer:{color:a.palette.text.secondary,lineHeight:a.typography.pxToRem(21),fontSize:a.typography.pxToRem(12)},sizeSmall:{padding:"6px 24px 6px 16px","&:last-child":{paddingRight:16},"&$paddingCheckbox":{width:24,padding:"0 12px 0 16px","&:last-child":{paddingLeft:12,paddingRight:16},"& > *":{padding:0}}},paddingCheckbox:{width:48,padding:"0 0 0 4px","&:last-child":{paddingLeft:0,paddingRight:4}},paddingNone:{padding:0,"&:last-child":{padding:0}},alignLeft:{textAlign:"left"},alignCenter:{textAlign:"center"},alignRight:{textAlign:"right",flexDirection:"row-reverse"},alignJustify:{textAlign:"justify"},stickyHeader:{position:"sticky",top:0,left:0,zIndex:2,backgroundColor:a.palette.background.default}}},Aa=n.forwardRef(function(a,d){var p=a.align,s=p===void 0?"inherit":p,i=a.classes,m=a.className,y=a.component,b=a.padding,R=a.scope,B=a.size,T=a.sortDirection,x=a.variant,N=ae(a,["align","classes","className","component","padding","scope","size","sortDirection","variant"]),g=n.useContext($t),_=n.useContext(Ue),L=_&&_.variant==="head",W,I;y?(I=y,W=L?"columnheader":"cell"):I=L?"th":"td";var w=R;!w&&L&&(w="col");var A=b||(g&&g.padding?g.padding:"default"),k=B||(g&&g.size?g.size:"medium"),f=x||_&&_.variant,z=null;return T&&(z=T==="asc"?"ascending":"descending"),n.createElement(I,D({ref:d,className:Y(i.root,i[f],m,s!=="inherit"&&i["align".concat(Oe(s))],A!=="default"&&i["padding".concat(Oe(A))],k!=="medium"&&i["size".concat(Oe(k))],f==="head"&&g&&g.stickyHeader&&i.stickyHeader),"aria-sort":z,role:W,scope:w},N))});const r=te(xa,{name:"MuiTableCell"})(Aa);var Sa={root:{display:"table-header-group"}},ka={variant:"head"},vt="thead",$a=n.forwardRef(function(a,d){var p=a.classes,s=a.className,i=a.component,m=i===void 0?vt:i,y=ae(a,["classes","className","component"]);return n.createElement(Ue.Provider,{value:ka},n.createElement(m,D({className:Y(p.root,s),ref:d,role:m===vt?null:"rowgroup"},y)))});const ke=te(Sa,{name:"MuiTableHead"})($a);var Ra=function(a){return{root:{color:"inherit",display:"table-row",verticalAlign:"middle",outline:0,"&$hover:hover":{backgroundColor:a.palette.action.hover},"&$selected, &$selected:hover":{backgroundColor:Qe(a.palette.secondary.main,a.palette.action.selectedOpacity)}},selected:{},hover:{},head:{},footer:{}}},Et="tr",Ta=n.forwardRef(function(a,d){var p=a.classes,s=a.className,i=a.component,m=i===void 0?Et:i,y=a.hover,b=y===void 0?!1:y,R=a.selected,B=R===void 0?!1:R,T=ae(a,["classes","className","component","hover","selected"]),x=n.useContext(Ue);return n.createElement(m,D({ref:d,className:Y(p.root,s,x&&{head:p.head,footer:p.footer}[x.variant],b&&p.hover,B&&p.selected),role:m===Et?null:"row"},T))});const J=te(Ra,{name:"MuiTableRow"})(Ta);var Xe={},Ba=ea,wa=ta;Object.defineProperty(Xe,"__esModule",{value:!0});var Le=Xe.default=void 0,Pa=wa(n),Ia=Ba(Zt()),za=(0,Ia.default)(Pa.createElement("path",{d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore");Le=Xe.default=za;const E=new la({}.REACT_APP_API_BASE_URL),bt=["today","national","sports","weather","schools","obituaries"];function Ge(u){var a;return!!((a=u==null?void 0:u.publishedAt)!=null&&a.startsWith("9999"))}function Ha(){var dt;const[u,a]=n.useState(""),[d,p]=n.useState(!!E.getAdminPanelKey()),[s,i]=n.useState(""),[m,y]=n.useState(!0),[b,R]=n.useState(0),[B,T]=n.useState([]),[x,N]=n.useState(null),[g,_]=n.useState(null),[L,W]=n.useState([]),[I,w]=n.useState([]),[A,k]=n.useState(""),[f,z]=n.useState(null),[P,G]=n.useState("all"),[Q,O]=n.useState(""),[ne,oe]=n.useState(!1),[X,H]=n.useState([]),[$e,q]=n.useState(null),[pe,se]=n.useState(!1),[ge,Re]=n.useState(!1),[ye,ce]=n.useState(null),[fe,h]=n.useState(null),[S,F]=n.useState(null),[K,j]=n.useState([]),[le,he]=n.useState(null),[de,ve]=n.useState({}),[Ee,We]=n.useState(""),[Te,Be]=n.useState(""),[Ze,we]=n.useState(""),[et,Pe]=n.useState(""),[tt,He]=n.useState(""),[be,Fe]=n.useState(!1),[Ie,ze]=n.useState(""),[Ke,at]=n.useState(!1),[nt,lt]=n.useState(!1),[rt,Me]=n.useState(null),[it,Z]=n.useState(""),ue=async()=>{if(d){y(!0),i("");try{const[t,l,c]=await Promise.all([E.getAdminSources(),E.getAdminArticles({category:P,search:Q,limit:200}),E.getBlockedArticles()]),[o,M]=await Promise.all([E.getAdminMetrics(),E.getAdminRejections()]);T(t.items||[]),N(t),_((o==null?void 0:o.latest)||null),W((M==null?void 0:M.items)||[]),w((M==null?void 0:M.duplicateItems)||[]);const re=l.items||[];H(re),q(l.nextCursor||null),se(!!l.nextCursor),j((c==null?void 0:c.items)||[]),ve({})}catch(t){console.error(t),i((t==null?void 0:t.errorMessage)||"Unable to load admin data. Check password and worker deployment.")}finally{y(!1)}}};n.useEffect(()=>{d&&ue()},[d]);const ot=async()=>{if(d){y(!0),i("");try{const t=await E.getAdminArticles({category:P,search:Q,limit:200}),l=t.items||[];H(l),q(t.nextCursor||null),se(!!t.nextCursor),ve({})}catch(t){console.error(t),i((t==null?void 0:t.errorMessage)||"Unable to filter articles.")}finally{y(!1)}}},De=(t,l)=>{ve(c=>({...c,[t]:{...c[t]||{},...l}}))},Rt=async t=>{const l=de[t.id]||{};ce(t.id);try{await E.retagArticle({id:t.id,category:l.category??t.category,isKentucky:l.isKentucky??t.isKentucky,county:l.county??t.county}),H(c=>c.map(o=>o.id===t.id?{...o,category:l.category??t.category,isKentucky:l.isKentucky??t.isKentucky,county:l.county??t.county,publishedAt:l.publishedAt??t.publishedAt}:o)),ve(c=>({...c,[t.id]:{}}))}catch(c){console.error(c),i((c==null?void 0:c.errorMessage)||"Retag failed.")}finally{ce(null)}},Tt=async t=>{const c=(de[t.id]||{}).publishedAt??t.publishedAt;if(!c){i("Published date/time is required.");return}ce(t.id),i("");try{const o=await E.updateAdminArticleDateTime({id:t.id,publishedAt:c}),M=(o==null?void 0:o.publishedAt)||c;H(re=>re.map(Ce=>Ce.id===t.id?{...Ce,publishedAt:M}:Ce)),ve(re=>({...re,[t.id]:{...re[t.id]||{},publishedAt:M}}))}catch(o){console.error(o),i((o==null?void 0:o.errorMessage)||"Unable to update date/time.")}finally{ce(null)}},st=async(t,l)=>{if(window.confirm(l?`Delete article #${t.id} and block it from future ingestion?`:`Delete article #${t.id}?`)){h(t.id),i("");try{if(await E.deleteAdminArticle({id:t.id,block:l,reason:l?"Blocked by admin console":""}),H(o=>o.filter(M=>M.id!==t.id)),l){const o=await E.getBlockedArticles();j((o==null?void 0:o.items)||[])}}catch(o){console.error(o),i((o==null?void 0:o.errorMessage)||"Unable to delete article.")}finally{h(null)}}},Bt=async t=>{if(t!=null&&t.id){he(t.id),i("");try{await E.unblockArticle({id:t.id}),j(l=>l.filter(c=>c.id!==t.id))}catch(l){console.error(l),i((l==null?void 0:l.errorMessage)||"Unable to unblock article.")}finally{he(null)}}},ct=async()=>{i(""),E.setAdminPanelKey(u);try{await E.getAdminSources(),p(!0),a("")}catch(t){p(!1),E.setAdminPanelKey(""),i((t==null?void 0:t.errorMessage)||"Invalid admin password.")}},wt=()=>{E.setAdminPanelKey(""),p(!1),T([]),H([]),q(null),se(!1),N(null),_(null),W([]),w([])},Pt=async t=>{if(t!=null&&t.url){k(t.url),i("");try{await E.publishAdminRejection({url:t.url,sourceUrl:t.sourceUrl,providedTitle:t.title,feedPublishedAt:t.publishedAt}),await ue()}catch(l){i((l==null?void 0:l.errorMessage)||"Unable to publish rejected item.")}finally{k("")}}},It=async()=>{if(!(!pe||!$e||ge)){Re(!0);try{const t=await E.getAdminArticles({category:P,search:Q,limit:200,cursor:$e}),l=t.items||[];H(c=>[...c,...l]),q(t.nextCursor||null),se(!!t.nextCursor)}catch(t){i((t==null?void 0:t.errorMessage)||"Unable to load more articles.")}finally{Re(!1)}}},je=t=>`https://localkynews.com/post?articleId=${t}`,zt=async t=>{F(t.id),i("");try{const l=new Date().toISOString();await E.updateAdminArticleDateTime({id:t.id,publishedAt:l}),H(c=>c.map(o=>o.id===t.id?{...o,publishedAt:l}:o))}catch(l){console.error(l),i((l==null?void 0:l.errorMessage)||"Unable to publish article.")}finally{F(null)}},Mt=async()=>{if(Ee.trim()){lt(!0),Z(""),Me(null);try{const t=await E.previewFacebookPost(Ee.trim());t!=null&&t.ok?(t.title&&Be(t.title),t.body&&we(t.body),t.imageUrl&&Pe(t.imageUrl),t.publishedAt&&!Ie&&ze(Ct(t.publishedAt))):Z((t==null?void 0:t.message)||"Could not auto-fill from Facebook. Fill fields manually.")}catch(t){Z((t==null?void 0:t.errorMessage)||"Failed to load Facebook post.")}finally{lt(!1)}}},Dt=async()=>{if(!Te.trim()){Z("Title is required.");return}at(!0),Z(""),Me(null);try{const t=Ie?xt(Ie):new Date().toISOString(),l=await E.createManualArticle({title:Te.trim(),body:Ze.trim()||null,imageUrl:et.trim()||null,sourceUrl:Ee.trim()||null,county:tt||null,isDraft:be,publishedAt:t});(l==null?void 0:l.status)==="inserted"?(Me(`${be?"Draft saved":"Article published"}! ID: ${l.id} | Category: ${l.category} | County: ${l.county||"none"}`),We(""),Be(""),we(""),Pe(""),He(""),Fe(!1),ze(""),ot()):(l==null?void 0:l.status)==="duplicate"?Z(`Duplicate – an article with this URL already exists (ID: ${l.id}).`):Z("Unexpected response from server.")}catch(t){Z((t==null?void 0:t.errorMessage)||"Failed to create article.")}finally{at(!1)}},Nt=async()=>{i("");try{await E.adminIngest({includeSchools:!0,limitPerSource:0}),await ue()}catch(t){i((t==null?void 0:t.errorMessage)||"Unable to start ingest.")}},_t=async()=>{if(window.confirm("This will DELETE all article rows and start re-ingest. Continue?")){i("");try{await E.adminPurgeAndReingest({includeSchools:!0,limitPerSource:0}),await ue()}catch(l){i((l==null?void 0:l.errorMessage)||"Purge/re-ingest failed.")}}},Lt=async()=>{i(""),z({status:"running",message:"Backfill started — polling for results every 5 seconds...",processed:0,missingCount:"?"});try{await E.adminBackfillCounties({threshold:5});let t=0;const l=setInterval(async()=>{t++;try{const c=await E.getBackfillStatus(),o=c==null?void 0:c.status;(o==null?void 0:o.status)==="complete"||(o==null?void 0:o.status)==="error"?(clearInterval(l),z(o)):(o==null?void 0:o.status)==="running"&&z({...o,message:`Running… ${o.processed??0} / ${o.missingCount??"?"} counties processed`}),t>72&&(clearInterval(l),z(M=>({...M||{},status:"timeout",message:"Backfill is still running. Refresh this page to check again."})))}catch{}},5e3)}catch(t){i((t==null?void 0:t.errorMessage)||"Backfill failed to start."),z(null)}},Ne=X.filter(Ge).length,Ut=ne?X.filter(Ge):X;return d?e.createElement($,null,e.createElement($,{style:{display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",marginBottom:8}},e.createElement(v,{variant:"h5"},"Admin Console"),e.createElement(C,{size:"small",variant:"outlined",onClick:wt},"Lock")),s&&e.createElement(v,{color:"error",variant:"body2",style:{marginBottom:10}},s),e.createElement(me,{square:!0,style:{marginBottom:16}},e.createElement(aa,{value:b,onChange:(t,l)=>R(l),indicatorColor:"primary",textColor:"primary",variant:"scrollable",scrollButtons:"auto"},e.createElement(xe,{label:"Dashboard"}),e.createElement(xe,{label:"Create Article"}),e.createElement(xe,{label:Ne>0?`Articles (${Ne} draft${Ne!==1?"s":""})`:"Articles"}),e.createElement(xe,{label:"Sources"}),e.createElement(xe,{label:"Blocked"}))),b===0&&e.createElement($,null,e.createElement($,{style:{display:"flex",gap:8,flexWrap:"wrap",marginBottom:16}},e.createElement(C,{variant:"contained",color:"primary",onClick:Nt},"Ingest new articles"),e.createElement(C,{variant:"contained",color:"secondary",onClick:_t},"Purge + Re-ingest"),e.createElement(C,{variant:"contained",color:"primary",onClick:Lt},"Backfill Counties"),e.createElement(C,{variant:"outlined",onClick:ue,disabled:m},m?"Loading…":"Refresh")),g&&e.createElement(me,{style:{padding:12,marginBottom:16}},e.createElement(v,{variant:"subtitle2",gutterBottom:!0},"Latest Ingest Run"),e.createElement($,{style:{display:"flex",gap:8,flexWrap:"wrap"}},e.createElement(U,{size:"small",label:`Trigger: ${g.trigger??"—"}`}),e.createElement(U,{size:"small",label:`Rate/min: ${g.ingestRatePerMinute??0}`,color:"primary"}),e.createElement(U,{size:"small",label:`Inserted: ${g.inserted??0}`}),e.createElement(U,{size:"small",label:`Duplicates: ${g.duplicate??0}`}),e.createElement(U,{size:"small",label:`Rejected: ${g.rejected??0}`}),e.createElement(U,{size:"small",label:`Low-word: ${g.lowWordDiscards??0}`}),e.createElement(U,{size:"small",label:`Duration: ${((g.durationMs??0)/1e3).toFixed(1)}s`}))),f&&e.createElement(me,{style:{padding:12,marginBottom:16}},e.createElement(v,{variant:"subtitle2",gutterBottom:!0},"County Backfill — ",f.status==="running"?"In Progress":f.status==="complete"?"✅ Complete":f.status==="timeout"?"⏳ Still Running":"Status"),f.message&&e.createElement(v,{variant:"body2",color:"textSecondary",style:{marginBottom:8}},f.message),f.status==="running"&&e.createElement(v,{variant:"body2"},"Counties processed: ",f.processed??0," / ",f.missingCount??"?"),f.status==="complete"&&e.createElement(v,{variant:"body2",style:{marginBottom:6}},"Processed ",f.processed??0," of ",f.missingCount??"?"," counties below threshold. Finished: ",f.finishedAt?new Date(f.finishedAt).toLocaleTimeString():"—"),((dt=f.results)==null?void 0:dt.length)>0&&e.createElement("pre",{style:{whiteSpace:"pre-wrap",fontSize:11,maxHeight:300,overflow:"auto"}},JSON.stringify(f.results,null,2))),e.createElement(me,{style:{padding:16}},e.createElement(v,{variant:"h6",gutterBottom:!0},"Ingest Decisions (Latest Run)"),e.createElement(v,{variant:"body2",color:"textSecondary",gutterBottom:!0},"Rejected items can be force-published. Duplicates indicate URLs already stored."),e.createElement(Ve,{defaultExpanded:!1},e.createElement(Ye,{expandIcon:e.createElement(Le,null)},e.createElement(v,{variant:"subtitle2"},"Rejected (",L.length,")")),e.createElement(Je,{style:{display:"block",padding:0}},L.length===0?e.createElement(v,{variant:"body2",color:"textSecondary",style:{padding:12}},"No rejected samples captured in the latest run."):e.createElement(Ae,{size:"small",style:{marginBottom:12}},e.createElement(ke,null,e.createElement(J,null,e.createElement(r,null,"URL"),e.createElement(r,null,"Reason"),e.createElement(r,null,"Source"),e.createElement(r,null,"Local"),e.createElement(r,null,"Publish"))),e.createElement(Se,null,L.slice(0,100).map((t,l)=>e.createElement(J,{key:`${t.url}-${l}`},e.createElement(r,{style:{maxWidth:300,overflowWrap:"anywhere"}},t.url),e.createElement(r,null,t.reason||"unknown"),e.createElement(r,{style:{maxWidth:220,overflowWrap:"anywhere"}},t.sourceUrl||"—"),e.createElement(r,null,t.id?e.createElement(C,{size:"small",variant:"outlined",color:"primary",href:je(t.id),target:"_blank",rel:"noopener noreferrer"},"Open"):"—"),e.createElement(r,null,e.createElement(C,{size:"small",variant:"contained",color:"primary",disabled:A===t.url,onClick:()=>Pt(t)},A===t.url?"Publishing…":"Publish")))))))),e.createElement(Ve,{defaultExpanded:!1},e.createElement(Ye,{expandIcon:e.createElement(Le,null)},e.createElement(v,{variant:"subtitle2"},"Duplicates (",I.length,")")),e.createElement(Je,{style:{display:"block",padding:0}},I.length===0?e.createElement(v,{variant:"body2",color:"textSecondary",style:{padding:12}},"No duplicate samples captured in the latest run."):e.createElement(Ae,{size:"small"},e.createElement(ke,null,e.createElement(J,null,e.createElement(r,null,"URL"),e.createElement(r,null,"Reason"),e.createElement(r,null,"Source"),e.createElement(r,null,"Local"))),e.createElement(Se,null,I.slice(0,100).map((t,l)=>e.createElement(J,{key:`${t.url}-dup-${l}`},e.createElement(r,{style:{maxWidth:300,overflowWrap:"anywhere"}},t.url),e.createElement(r,null,t.reason||"duplicate"),e.createElement(r,{style:{maxWidth:220,overflowWrap:"anywhere"}},t.sourceUrl||"—"),e.createElement(r,null,t.id?e.createElement(C,{size:"small",variant:"outlined",color:"primary",href:je(t.id),target:"_blank",rel:"noopener noreferrer"},"Open"):"—"))))))))),b===1&&e.createElement($,null,e.createElement(Ve,{defaultExpanded:!0},e.createElement(Ye,{expandIcon:e.createElement(Le,null)},e.createElement(v,{variant:"h6"},"Create Manual Article")),e.createElement(Je,{style:{display:"block"}},e.createElement(v,{variant:"body2",color:"textSecondary",style:{marginBottom:12}},"Paste a Facebook post URL to auto-fill — no access token needed, public pages are scraped automatically. Or fill fields manually. All articles are tagged as Kentucky content; category is auto-classified by AI. Drafts are saved privately and can be published later from the Articles tab."),e.createElement($,{style:{display:"flex",gap:8,alignItems:"center",marginBottom:12,flexWrap:"wrap"}},e.createElement(ee,{variant:"outlined",size:"small",label:"Facebook Post URL (optional)",placeholder:"https://www.facebook.com/leslieCoBOE/posts/…",value:Ee,onChange:t=>We(t.target.value),style:{minWidth:360,flex:1}}),e.createElement(C,{variant:"outlined",color:"primary",disabled:nt||!Ee.trim(),onClick:Mt},nt?"Loading…":"Load from Facebook")),e.createElement(ee,{fullWidth:!0,variant:"outlined",size:"small",label:"Title *",value:Te,onChange:t=>Be(t.target.value),style:{marginBottom:12}}),e.createElement(ee,{fullWidth:!0,variant:"outlined",size:"small",label:"Body (optional)",multiline:!0,rows:8,value:Ze,onChange:t=>we(t.target.value),style:{marginBottom:12}}),e.createElement(ee,{fullWidth:!0,variant:"outlined",size:"small",label:"Image URL (optional)",value:et,onChange:t=>Pe(t.target.value),style:{marginBottom:12}}),e.createElement(ee,{variant:"outlined",size:"small",label:"Date & Time (optional — defaults to now)",type:"datetime-local",value:Ie,onChange:t=>ze(t.target.value),InputLabelProps:{shrink:!0},style:{marginBottom:12,minWidth:280}}),e.createElement($,{style:{display:"flex",gap:12,alignItems:"center",flexWrap:"wrap",marginBottom:16}},e.createElement(qe,{variant:"outlined",size:"small",style:{minWidth:200}},e.createElement(pt,null,"County (optional)"),e.createElement(_e,{value:tt,onChange:t=>He(t.target.value),label:"County (optional)"},e.createElement(ie,{value:""},e.createElement("em",null,"None / let AI decide")),na.map(t=>e.createElement(ie,{key:t,value:t},t)))),e.createElement(gt,{control:e.createElement(yt,{checked:be,onChange:t=>Fe(t.target.checked),color:"primary"}),label:be?"Save as draft (private)":"Publish immediately"})),e.createElement($,{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"}},e.createElement(C,{variant:"contained",color:"primary",disabled:Ke||!Te.trim(),onClick:Dt},Ke?"Saving…":be?"Save Draft":"Publish Article"),e.createElement(C,{variant:"outlined",disabled:Ke,onClick:()=>{We(""),Be(""),we(""),Pe(""),He(""),Fe(!1),ze(""),Z(""),Me(null)}},"Clear")),it&&e.createElement(v,{color:"error",variant:"body2",style:{marginTop:10}},it),rt&&e.createElement(v,{style:{color:"green",marginTop:10},variant:"body2"},rt)))),b===2&&e.createElement($,null,e.createElement(v,{variant:"h6",gutterBottom:!0},"Articles"),e.createElement($,{style:{display:"flex",gap:12,flexWrap:"wrap",marginBottom:12,alignItems:"center"}},e.createElement(qe,{variant:"outlined",size:"small",style:{minWidth:180}},e.createElement(pt,null,"Category"),e.createElement(_e,{value:P,onChange:t=>G(t.target.value),label:"Category"},e.createElement(ie,{value:"all"},"all"),bt.map(t=>e.createElement(ie,{key:t,value:t},t)))),e.createElement(ee,{variant:"outlined",size:"small",label:"Search",value:Q,onChange:t=>O(t.target.value)}),e.createElement(C,{variant:"contained",color:"primary",onClick:ot},"Filter"),e.createElement(C,{variant:"outlined",onClick:ue,disabled:m},"Reload All"),e.createElement(gt,{control:e.createElement(yt,{checked:ne,onChange:t=>oe(t.target.checked),color:"primary",size:"small"}),label:`Drafts only (${Ne})`}),e.createElement(U,{label:`Loaded: ${X.length}`,size:"small"})),m?e.createElement(mt,{size:24}):e.createElement(Ae,{size:"small"},e.createElement(ke,null,e.createElement(J,null,e.createElement(r,null,"ID"),e.createElement(r,null,"Status"),e.createElement(r,null,"Title"),e.createElement(r,null,"Published (UTC)"),e.createElement(r,null,"Category"),e.createElement(r,null,"KY"),e.createElement(r,null,"County"),e.createElement(r,null,"Links"),e.createElement(r,null,"Actions"))),e.createElement(Se,null,Ut.map(t=>{const l=Ge(t),c=de[t.id]||{},o=c.category??t.category,M=c.isKentucky??t.isKentucky,re=c.county??t.county??"",Ce=c.publishedAt??t.publishedAt??"";return e.createElement(J,{key:t.id,style:l?{backgroundColor:"#fffde7"}:{}},e.createElement(r,null,t.id),e.createElement(r,null,l?e.createElement(U,{size:"small",label:"DRAFT",style:{backgroundColor:"#ff9800",color:"#fff"}}):e.createElement(U,{size:"small",label:"Live",color:"primary"})),e.createElement(r,{style:{maxWidth:360,overflowWrap:"anywhere"}},t.title),e.createElement(r,null,l?e.createElement(v,{variant:"caption",color:"textSecondary"},"Not published"):e.createElement(ee,{variant:"outlined",size:"small",type:"datetime-local",value:Ct(Ce),onChange:V=>De(t.id,{publishedAt:xt(V.target.value)}),InputLabelProps:{shrink:!0}})),e.createElement(r,null,e.createElement(qe,{variant:"outlined",size:"small",style:{minWidth:130}},e.createElement(_e,{value:o,onChange:V=>De(t.id,{category:V.target.value})},bt.map(V=>e.createElement(ie,{key:V,value:V},V))))),e.createElement(r,null,e.createElement(_e,{value:M?"yes":"no",variant:"outlined",size:"small",onChange:V=>De(t.id,{isKentucky:V.target.value==="yes"})},e.createElement(ie,{value:"yes"},"yes"),e.createElement(ie,{value:"no"},"no"))),e.createElement(r,null,e.createElement(ee,{variant:"outlined",size:"small",value:re,onChange:V=>De(t.id,{county:V.target.value}),placeholder:"optional",style:{width:120}})),e.createElement(r,null,e.createElement($,{style:{display:"flex",gap:6,flexWrap:"wrap"}},!l&&e.createElement(C,{size:"small",variant:"outlined",color:"primary",href:je(t.id),target:"_blank",rel:"noopener noreferrer"},"Live"),e.createElement(C,{size:"small",variant:"outlined",href:t.canonicalUrl||t.sourceUrl||"#",target:"_blank",rel:"noopener noreferrer",disabled:!t.canonicalUrl&&!t.sourceUrl},"Source"))),e.createElement(r,null,e.createElement($,{style:{display:"flex",gap:6,flexWrap:"wrap"}},l&&e.createElement(C,{size:"small",variant:"contained",color:"primary",disabled:S===t.id,onClick:()=>zt(t)},S===t.id?"Publishing…":"Publish Now"),e.createElement(C,{size:"small",variant:"contained",color:"primary",disabled:ye===t.id,onClick:()=>Rt(t)},ye===t.id?"Saving…":"Save tags"),!l&&e.createElement(C,{size:"small",variant:"outlined",color:"primary",disabled:ye===t.id,onClick:()=>Tt(t)},"Save date"),e.createElement(C,{size:"small",variant:"outlined",color:"secondary",disabled:fe===t.id,onClick:()=>st(t,!1)},"Delete"),e.createElement(C,{size:"small",variant:"contained",color:"secondary",disabled:fe===t.id,onClick:()=>st(t,!0)},fe===t.id?"Working…":"Delete + Block"))))}))),e.createElement($,{style:{marginTop:10,display:"flex",justifyContent:"flex-end"}},e.createElement(C,{variant:"contained",color:"primary",disabled:!pe||ge,onClick:It},ge?"Loading…":pe?"Load More":"No More Articles"))),b===3&&e.createElement($,null,e.createElement(v,{variant:"h6",gutterBottom:!0},"Source Health"),x&&e.createElement($,{style:{display:"flex",gap:8,marginBottom:12,flexWrap:"wrap"}},e.createElement(U,{label:`Configured: ${x.totalConfiguredSources||0}`}),e.createElement(U,{label:`Active: ${x.activeSources||0}`,color:"primary"}),e.createElement(U,{label:`No articles yet: ${x.inactiveSources||0}`})),m?e.createElement(mt,{size:24}):e.createElement(Ae,{size:"small"},e.createElement(ke,null,e.createElement(J,null,e.createElement(r,null,"Source"),e.createElement(r,{align:"right"},"Articles"),e.createElement(r,null,"Latest Published"),e.createElement(r,null,"Status"))),e.createElement(Se,null,B.slice(0,200).map(t=>e.createElement(J,{key:t.sourceUrl},e.createElement(r,{style:{maxWidth:420,overflowWrap:"anywhere"}},t.sourceUrl),e.createElement(r,{align:"right"},t.articleCount),e.createElement(r,null,t.latestPublishedAt||"—"),e.createElement(r,null,e.createElement(U,{size:"small",label:t.status,color:t.status==="active"?"primary":"default"}))))))),b===4&&e.createElement($,null,e.createElement(v,{variant:"h6",gutterBottom:!0},"Blocked Articles"),e.createElement(v,{variant:"body2",color:"textSecondary",gutterBottom:!0},"Blocked URLs are rejected during future ingest runs."),e.createElement(Ae,{size:"small"},e.createElement(ke,null,e.createElement(J,null,e.createElement(r,null,"ID"),e.createElement(r,null,"URL"),e.createElement(r,null,"Reason"),e.createElement(r,null,"Blocked At"),e.createElement(r,null,"Action"))),e.createElement(Se,null,K.length===0?e.createElement(J,null,e.createElement(r,{colSpan:5},"No blocked articles.")):K.map(t=>e.createElement(J,{key:`blocked-${t.id}`},e.createElement(r,null,t.id),e.createElement(r,{style:{maxWidth:420,overflowWrap:"anywhere"}},t.canonicalUrl||t.sourceUrl||"—"),e.createElement(r,null,t.reason||"—"),e.createElement(r,null,t.createdAt||"—"),e.createElement(r,null,e.createElement(C,{size:"small",variant:"outlined",color:"primary",disabled:le===t.id,onClick:()=>Bt(t)},le===t.id?"Unblocking…":"Unblock")))))))):e.createElement($,null,e.createElement(v,{variant:"h5",gutterBottom:!0},"Admin Console"),e.createElement(v,{variant:"body2",color:"textSecondary",gutterBottom:!0},"Enter admin password to continue."),e.createElement(me,{style:{padding:16,maxWidth:420}},e.createElement(ee,{fullWidth:!0,variant:"outlined",size:"small",label:"Admin Password",type:"password",value:u,onChange:t=>a(t.target.value),onKeyDown:t=>t.key==="Enter"&&ct()}),e.createElement($,{style:{marginTop:12,display:"flex",gap:8}},e.createElement(C,{variant:"contained",color:"primary",onClick:ct},"Unlock")),s&&e.createElement(v,{color:"error",variant:"body2",style:{marginTop:10}},s)))}function Ct(u){if(!u)return"";const a=new Date(u);if(!Number.isFinite(a.getTime()))return"";const d=b=>String(b).padStart(2,"0"),p=a.getFullYear(),s=d(a.getMonth()+1),i=d(a.getDate()),m=d(a.getHours()),y=d(a.getMinutes());return`${p}-${s}-${i}T${m}:${y}`}function xt(u){if(!u)return"";const a=new Date(u);return Number.isFinite(a.getTime())?a.toISOString():""}export{Ha as default};
