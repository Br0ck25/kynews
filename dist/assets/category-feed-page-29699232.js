import{d as x,r,w as W,_ as j,e as $,f as V,g as K,h as B,R as n,i as O,I as T,j as A,u as D,k as Y,s as G,l as P,m as q,T as z,K as J,L as Q,B as X,C as Z,n as ee,S as te,o as ne}from"./index-4c6cfbd6.js";import{S as re}from"./skeletons-component-3c1ff673.js";import{F as oe}from"./featured-post-component-b50a9907.js";import{P as ae}from"./posts-component-4f24ec29.js";import{F as ce,I as se,S as le}from"./Select-25888060.js";import{M as ie}from"./MenuItem-d854b7fe.js";import{S as ue}from"./SwitchBase-a6a24965.js";const de=x(r.createElement("path",{d:"M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"})),me=x(r.createElement("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"})),fe=x(r.createElement("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10H7v-2h10v2z"}));var pe=function(e){return{root:{color:e.palette.text.secondary},checked:{},disabled:{},indeterminate:{},colorPrimary:{"&$checked":{color:e.palette.primary.main,"&:hover":{backgroundColor:B(e.palette.primary.main,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},"&$disabled":{color:e.palette.action.disabled}},colorSecondary:{"&$checked":{color:e.palette.secondary.main,"&:hover":{backgroundColor:B(e.palette.secondary.main,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},"&$disabled":{color:e.palette.action.disabled}}}},he=r.createElement(me,null),ve=r.createElement(de,null),Ee=r.createElement(fe,null),ge=r.forwardRef(function(e,_){var m=e.checkedIcon,f=m===void 0?he:m,c=e.classes,l=e.color,g=l===void 0?"secondary":l,p=e.icon,I=p===void 0?ve:p,i=e.indeterminate,u=i===void 0?!1:i,h=e.indeterminateIcon,b=h===void 0?Ee:h,w=e.inputProps,S=e.size,v=S===void 0?"medium":S,C=j(e,["checkedIcon","classes","color","icon","indeterminate","indeterminateIcon","inputProps","size"]),E=u?b:I,s=u?b:f;return r.createElement(ue,$({type:"checkbox",classes:{root:V(c.root,c["color".concat(K(g))],u&&c.indeterminate),checked:c.checked,disabled:c.disabled},color:g,inputProps:$({"data-indeterminate":u},w),icon:r.cloneElement(E,{fontSize:E.props.fontSize===void 0&&v==="small"?v:E.props.fontSize}),checkedIcon:r.cloneElement(s,{fontSize:s.props.fontSize===void 0&&v==="small"?v:s.props.fontSize}),ref:_},C))});const be=W(pe,{name:"MuiCheckbox"})(ge);function Se(){const[o,e]=r.useState(!navigator.onLine);return setTimeout(()=>{e(!1)},10*1e3),n.createElement(O,{anchorOrigin:{vertical:"top",horizontal:"center"},open:o,message:"You're offline right now. Recently viewed articles will be shown when available.",action:n.createElement(T,{"aria-label":"close",color:"inherit",onClick:()=>e(!o)},n.createElement(A,null))})}const ke=ee(o=>({root:{},countyFilterWrap:{marginBottom:o.spacing(2)},close:{padding:o.spacing(.5)},loaderWrap:{display:"flex",justifyContent:"center",padding:o.spacing(3)}})),F=new te({}.REACT_APP_API_BASE_URL),Ie=20;function N(o){return Ie}function Le({category:o,title:e,countyFilterEnabled:_=!1}){const m=ke(),f=D(t=>t.selectedCounties),c=Y(),[l,g]=r.useState([]),[p,I]=r.useState(null),[i,u]=r.useState(!0),[h,b]=r.useState(!0),[w,S]=r.useState(!1),[v,C]=r.useState(""),E=r.useRef(null),s=r.useRef(!1),k=r.useRef(!0),L=(f||[]).join("|"),M=o==="national"?[]:f||[],H=(f||[]).length>0;r.useEffect(()=>{c(G(e))},[e,c]),r.useEffect(()=>()=>{k.current=!1},[]),r.useEffect(()=>{k.current=!0,g([]),I(null),u(!0),b(!0),C(""),s.current=!1;let t=!0;return F.fetchPage({category:o,counties:M,cursor:null,limit:N()}).then(({posts:a,nextCursor:d})=>{!t||!k.current||P.unstable_batchedUpdates(()=>{g(a),I(d),u(d!==null),c(q(a)),b(!1)})}).catch(a=>{!t||!k.current||P.unstable_batchedUpdates(()=>{C(a.errorMessage||"Failed to load posts."),b(!1)})}),()=>{t=!1}},[o,L]);const y=r.useCallback(()=>{s.current||!i||!p||(s.current=!0,S(!0),F.fetchPage({category:o,counties:M,cursor:p,limit:N()}).then(({posts:t,nextCursor:a})=>{k.current&&P.unstable_batchedUpdates(()=>{g(d=>[...d,...t]),I(a),u(a!==null),s.current=!1,S(!1)})}).catch(()=>{k.current&&P.unstable_batchedUpdates(()=>{s.current=!1,S(!1)})}))},[o,L,p,i]);r.useEffect(()=>{const t=E.current;if(!t)return;let a;typeof IntersectionObserver<"u"&&(a=new IntersectionObserver(R=>{R[0].isIntersecting&&y()},{rootMargin:"400px"}),a.observe(t));const d=()=>{if(!t)return;t.getBoundingClientRect().top<=window.innerHeight+400&&y()};return window.addEventListener("scroll",d,{passive:!0}),d(),()=>{a&&a.disconnect(),window.removeEventListener("scroll",d)}},[y,h]),r.useEffect(()=>{if(h||s.current||!i||!p)return;const t=E.current;if(!t)return;t.getBoundingClientRect().top<=window.innerHeight+400&&y()},[l.length,i,h,y]);const U=t=>{c(ne(t.target.value))};return n.createElement("div",{className:m.root},n.createElement(Se,null),n.createElement(z,{variant:"h5",component:"h1",gutterBottom:!0},e),_&&o!=="national"&&n.createElement("div",{className:m.countyFilterWrap},n.createElement(ce,{fullWidth:!0,variant:"outlined",size:"small"},n.createElement(se,{id:`${o}-counties-label`},"Counties"),n.createElement(le,{labelId:`${o}-counties-label`,multiple:!0,value:f,onChange:U,label:"Counties",renderValue:t=>t.length>0?t.join(", "):"All counties"},J.map(t=>n.createElement(ie,{key:t,value:t},n.createElement(be,{checked:f.indexOf(t)>-1}),n.createElement(Q,{primary:t})))))),h?n.createElement(re,{showFeaturedSkeleton:!0}):l.length===0?n.createElement(z,{variant:"body1"},o==="national"?"No articles found for this section.":H?"No articles found for the selected counties.":"No articles found for this section yet."):n.createElement(n.Fragment,null,n.createElement(oe,{post:l[0]}),n.createElement(ae,{posts:l.filter((t,a)=>a!==0)}),n.createElement("div",{ref:E,style:{height:1}}),w&&n.createElement(X,{className:m.loaderWrap},n.createElement(Z,{size:32})),!i&&l.length>0&&n.createElement(z,{variant:"body2",color:"textSecondary",align:"center",style:{padding:16}},"All articles loaded.")),n.createElement(O,{anchorOrigin:{vertical:"top",horizontal:"center"},open:!!v,message:v,key:`${o}-error`,action:n.createElement(T,{"aria-label":"close",color:"inherit",className:m.close,onClick:()=>C("")},n.createElement(A,null))}))}export{Le as C};
