import{d as _,r,w as W,_ as j,e as R,f as V,g as K,h as $,R as n,i as N,I as O,j as T,u as U,k as Y,s as D,l as G,T as z,K as q,L as J,B as Q,C as X,m as Z,S as ee,n as te}from"./index-024f792c.js";import{S as ne}from"./skeletons-component-8cf6a8aa.js";import{F as re}from"./featured-post-component-693a9d20.js";import{P as oe}from"./posts-component-821a394d.js";import{F as ae,I as ce,S as se}from"./Select-8949c7e6.js";import{M as le}from"./MenuItem-cdc2c5b5.js";import{S as ie}from"./SwitchBase-d0c689b8.js";const ue=_(r.createElement("path",{d:"M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"})),de=_(r.createElement("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"})),me=_(r.createElement("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10H7v-2h10v2z"}));var fe=function(e){return{root:{color:e.palette.text.secondary},checked:{},disabled:{},indeterminate:{},colorPrimary:{"&$checked":{color:e.palette.primary.main,"&:hover":{backgroundColor:$(e.palette.primary.main,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},"&$disabled":{color:e.palette.action.disabled}},colorSecondary:{"&$checked":{color:e.palette.secondary.main,"&:hover":{backgroundColor:$(e.palette.secondary.main,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},"&$disabled":{color:e.palette.action.disabled}}}},pe=r.createElement(de,null),he=r.createElement(ue,null),ve=r.createElement(me,null),Ee=r.forwardRef(function(e,P){var m=e.checkedIcon,f=m===void 0?pe:m,c=e.classes,l=e.color,v=l===void 0?"secondary":l,E=e.icon,b=E===void 0?he:E,i=e.indeterminate,u=i===void 0?!1:i,g=e.indeterminateIcon,S=g===void 0?ve:g,w=e.inputProps,k=e.size,p=k===void 0?"medium":k,C=j(e,["checkedIcon","classes","color","icon","indeterminate","indeterminateIcon","inputProps","size"]),h=u?S:b,s=u?S:f;return r.createElement(ie,R({type:"checkbox",classes:{root:V(c.root,c["color".concat(K(v))],u&&c.indeterminate),checked:c.checked,disabled:c.disabled},color:v,inputProps:R({"data-indeterminate":u},w),icon:r.cloneElement(h,{fontSize:h.props.fontSize===void 0&&p==="small"?p:h.props.fontSize}),checkedIcon:r.cloneElement(s,{fontSize:s.props.fontSize===void 0&&p==="small"?p:s.props.fontSize}),ref:P},C))});const ge=W(fe,{name:"MuiCheckbox"})(Ee);function Se(){const[o,e]=r.useState(!navigator.onLine);return setTimeout(()=>{e(!1)},10*1e3),n.createElement(N,{anchorOrigin:{vertical:"top",horizontal:"center"},open:o,message:"You're offline right now. Recently viewed articles will be shown when available.",action:n.createElement(O,{"aria-label":"close",color:"inherit",onClick:()=>e(!o)},n.createElement(T,null))})}const ke=Z(o=>({root:{},countyFilterWrap:{marginBottom:o.spacing(2)},close:{padding:o.spacing(.5)},loaderWrap:{display:"flex",justifyContent:"center",padding:o.spacing(3)}})),B=new ee({}.REACT_APP_API_BASE_URL),Ie=20;function F(o){return Ie}function xe({category:o,title:e,countyFilterEnabled:P=!1}){const m=ke(),f=U(t=>t.selectedCounties),c=Y(),[l,v]=r.useState([]),[E,b]=r.useState(null),[i,u]=r.useState(!0),[g,S]=r.useState(!0),[w,k]=r.useState(!1),[p,C]=r.useState(""),h=r.useRef(null),s=r.useRef(!1),I=r.useRef(!0),x=(f||[]).join("|"),L=o==="national"?[]:f||[],A=(f||[]).length>0;r.useEffect(()=>{c(D(e))},[e,c]),r.useEffect(()=>()=>{I.current=!1},[]),r.useEffect(()=>{I.current=!0,v([]),b(null),u(!0),S(!0),C(""),s.current=!1;let t=!0;return B.fetchPage({category:o,counties:L,cursor:null,limit:F()}).then(({posts:a,nextCursor:d})=>{!t||!I.current||(v(a),b(d),u(d!==null),c(G(a)),S(!1))}).catch(a=>{!t||!I.current||(C(a.errorMessage||"Failed to load posts."),S(!1))}),()=>{t=!1}},[o,x]);const y=r.useCallback(()=>{s.current||!i||!E||(s.current=!0,k(!0),B.fetchPage({category:o,counties:L,cursor:E,limit:F()}).then(({posts:t,nextCursor:a})=>{I.current&&(v(d=>[...d,...t]),b(a),u(a!==null),s.current=!1,k(!1))}).catch(()=>{I.current&&(s.current=!1,k(!1))}))},[o,x,E,i]);r.useEffect(()=>{const t=h.current;if(!t)return;let a;typeof IntersectionObserver<"u"&&(a=new IntersectionObserver(M=>{M[0].isIntersecting&&y()},{rootMargin:"400px"}),a.observe(t));const d=()=>{if(!t)return;t.getBoundingClientRect().top<=window.innerHeight+400&&y()};return window.addEventListener("scroll",d,{passive:!0}),d(),()=>{a&&a.disconnect(),window.removeEventListener("scroll",d)}},[y]),r.useEffect(()=>{if(g||s.current||!i)return;const t=h.current;if(!t)return;t.getBoundingClientRect().top<=window.innerHeight+400&&y()},[l.length,i,g,y]);const H=t=>{c(te(t.target.value))};return n.createElement("div",{className:m.root},n.createElement(Se,null),n.createElement(z,{variant:"h5",component:"h1",gutterBottom:!0},e),P&&o!=="national"&&n.createElement("div",{className:m.countyFilterWrap},n.createElement(ae,{fullWidth:!0,variant:"outlined",size:"small"},n.createElement(ce,{id:`${o}-counties-label`},"Counties"),n.createElement(se,{labelId:`${o}-counties-label`,multiple:!0,value:f,onChange:H,label:"Counties",renderValue:t=>t.length>0?t.join(", "):"All counties"},q.map(t=>n.createElement(le,{key:t,value:t},n.createElement(ge,{checked:f.indexOf(t)>-1}),n.createElement(J,{primary:t})))))),g?n.createElement(ne,{showFeaturedSkeleton:!0}):l.length===0?n.createElement(z,{variant:"body1"},o==="national"?"No articles found for this section.":A?"No articles found for the selected counties.":"No articles found for this section yet."):n.createElement(n.Fragment,null,n.createElement(re,{post:l[0]}),n.createElement(oe,{posts:l.filter((t,a)=>a!==0)}),n.createElement("div",{ref:h,style:{height:1}}),w&&n.createElement(Q,{className:m.loaderWrap},n.createElement(X,{size:32})),!i&&l.length>0&&n.createElement(z,{variant:"body2",color:"textSecondary",align:"center",style:{padding:16}},"All articles loaded.")),n.createElement(N,{anchorOrigin:{vertical:"top",horizontal:"center"},open:!!p,message:p,key:`${o}-error`,action:n.createElement(O,{"aria-label":"close",color:"inherit",className:m.close,onClick:()=>C("")},n.createElement(T,null))}))}export{xe as C};
